# OCR功能改进说明（第三版）

为了更好地处理数学文件，我们对OCR功能进行了进一步改进，结合了OCR识别题目编号的能力和图像切分功能，实现了更智能的文件处理方式。

## 1. 主要改进

### 1.1 智能题目识别与切分

- 使用OCR技术识别文件中的题目编号
- 根据识别到的题目编号确定题目边界
- 按照实际题目边界进行图像切分，而不是均匀切分
- 保留了原始的数学公式和排版

### 1.2 处理流程优化

- 将图像分割成小区域进行OCR识别，提高识别准确率
- 使用重叠区域避免题目被分割
- 智能合并识别结果，确定题目的实际边界
- 提供均匀切分作为备选方案，确保处理的稳定性

### 1.3 图像处理增强

- 增强图像质量，提高数学符号的清晰度
- 自适应阈值处理，优化黑白对比度
- 保持原始图像比例，确保公式完整性

## 2. 技术实现

### 2.1 题目边界识别

1. 将图像分割成多个小区域（高度100像素，重叠20像素）
2. 对每个区域进行OCR识别
3. 使用正则表达式识别题目编号和题型
4. 记录每个题目的开始位置
5. 根据下一个题目的开始位置确定当前题目的结束位置
6. 按题目编号排序，确保题目顺序正确

### 2.2 PDF处理流程

1. 将PDF文件的每一页渲染为高分辨率图像（300 DPI）
2. 对每一页进行题目边界识别
3. 根据识别到的边界切分图像
4. 增强切分后的图像质量
5. 为每个切分的图像创建题目记录
6. 如果未能识别出题目边界，则回退到均匀切分方式

### 2.3 图像处理流程

1. 读取图像文件
2. 进行题目边界识别
3. 根据识别到的边界切分图像
4. 增强切分后的图像质量
5. 为每个切分的图像创建题目记录
6. 如果未能识别出题目边界，则回退到均匀切分方式

## 3. 用户体验改进

- 题目编号与原文件一致，便于对照
- 题目类型自动识别（选择题、填空题、解答题、判断题）
- 所有题目默认设置为"仅使用图像显示"模式
- 提供全屏查看图像的功能
- 保留了编辑题目编号和类型的功能

## 4. 优势

1. **更准确的题目切分**：根据实际题目边界切分，而不是均匀切分
2. **保留原始题目编号**：自动识别并保留原始题目编号，便于对照
3. **自动识别题目类型**：识别题目类型，提高用户体验
4. **更好的容错性**：如果识别失败，自动回退到均匀切分方式
5. **更好的用户体验**：用户可以直接查看原始图像，无需担心识别错误

## 5. 使用建议

1. 使用清晰的原始文件，题目编号格式清晰（如"1."、"2."等）
2. PDF文件优于图片文件
3. 图片文件建议使用300DPI以上的分辨率
4. 黑白文档比彩色文档效果更好
5. 题目编号应当清晰可见，便于OCR识别

## 6. 未来改进方向

1. 改进OCR识别算法，提高题目编号识别准确率
2. 添加手动调整题目边界的功能
3. 支持更多的题目编号格式
4. 添加OCR结果的导出功能
5. 添加自定义识别参数的功能 